<!DOCTYPE html>
<html>
  <head>
    <title>Idiogrammatik</title>

    <link rel="stylesheet" href="idiogrammatik.css">

    <script src="d3.min.js"></script>
    <script src="idiogrammatik.js"></script>
  </head>

  <body>
    <script>
     idiogrammatik.load(function(err, data) {
       if (err)  return console.log('error: ', err);

       var lastPos = null, selection = null, shifted = false;

       window.onkeydown = function(e) { if (e.shiftKey) shifted = true; }
       window.onkeyup = function(e) { if (shifted) shifted = false; }

       var kgram = idiogrammatik()
            .on('click', function(position, kgram) {
              if (!position.chromosome)  return;

              if (selection) {
                selection.remove();
                selection = null;
                lastPos = null;
              }

              if (shifted) {
                if (lastPos) {
                  if (lastPos.absoluteBp < position.absoluteBp) {
                    selection = kgram.highlight(lastPos.absoluteBp, position.absoluteBp);
                  } else {
                    selection = kgram.highlight(position.absoluteBp, lastPos.absoluteBp);
                  }
                }
                lastPos = position;
              }

              console.log(position);
            })
            .on('mousemove', function(position, kgram) {
            })
            .highlight(50000000, 600000000,
                       {color: '#00FF00', opacity: 0.1})
            .highlight('chr20', 0, 'chr22', 0,
                       {color: '#FF0000', opacity: 0.1});

       d3.select('body')
           .datum(data)
           .call(kgram);

       window.h3 = kgram.highlight({chromosome: 'chr15', bp: 0},
                                   {chromosome: 'chr17', bp: 1000000});


       window.kgram = kgram;

     });
    </script>
  </body>

</html>
