<!DOCTYPE html>
<html>
  <head>
    <title>Idiogrammatik</title>

    <link rel="stylesheet" href="idiogrammatik.css">

    <script src="d3.min.js"></script>
    <script src="idiogrammatik.js"></script>
  </head>

  <body>
    <p>Shift-click to highlight regions. <code>kgram</code> is available in the global namespace to add highlights to, extend its functionality, etc..</p>
    <p><pre><code>kgram.highlight('chr2', 0, 'chr4', 0, {color: 'red', opacity: 0.5}); // for example</code></pre></p>
    <script>
     idiogrammatik.load(function(err, data) {
       if (err)  return console.log('error: ', err);

       var lastPos = null,
           selection = null,
           shifted = false;

       window.onkeydown = function(e) { if (e.shiftKey) shifted = true; };
       window.onkeyup = function(e) { if (shifted && !e.shiftKey) { shifted = false; lastPos = null; } };

       window.kgram = idiogrammatik()
            .on('click', function(position, kgram) {
              if (!position.chromosome) return;

              if (shifted) {
                if (selection && selection.remove) selection.remove();
                if (lastPos) {
                  selection = kgram.highlight(lastPos, position);
                  console.log(lastPos, position);
                  lastPos = null;
                } else {
                  lastPos = position;
                }
              }
            })
            .redraw(function(svg, scale) {
              var data = svg.selectAll('.chromosome').data();

              svg.selectAll('.cname')
                  .data(data, function(d) { return d.key; })
                .enter().append('text')
                  .attr('class', 'cname')
                  .attr('y', -9)
                  .text(function(d) { return d.key; });

              svg.selectAll('.cname')
                  .attr('x', function(d) { return scale(d.start); });
            });

       d3.select('body')
           .datum(data)
           .call(kgram);

       var highlightChr4 = kgram.highlight('chr4', 0, 'chr5', 0, {color: 'blue'});
     });
    </script>
  </body>

</html>
